package org.itechs.platform.gitutil;

import java.io.File;
import java.io.IOException;
import java.util.Date;
import java.util.List;

import org.eclipse.jgit.api.Git;
import org.eclipse.jgit.api.errors.GitAPIException;
import org.eclipse.jgit.api.errors.NoHeadException;
import org.eclipse.jgit.revwalk.RevCommit;

public class AccessGit {
	static Git git;  
	static int i = 0;//统计所有的commit的数量
	static int s=0;//统计给定时间段commit的数量
	public AccessGit() {
		// TODO Auto-generated constructor stub
	}

	public static void getHistoryInfo() {  
        File gitDir = new File("F:\\GitHub\\lustre-release\\.git");  
            try {  
                if (git == null) {  
                    git = Git.open(gitDir);  
                }  
                Iterable<RevCommit> gitlog= git.log().call();  
                for (RevCommit revCommit : gitlog) {  
                    //String version=revCommit.getName();//版本号  
                    //String name = revCommit.getAuthorIdent().getName();  
                    //revCommit.getAuthorIdent().getEmailAddress();  
                    //Date when = System.out.printlngetAuthorIdent().getWhen();//时间  
                    //String massage = revCommit.getFullMessage();
                    //System.out.println(name); 
                    //System.out.println(when.toString());  
                    //System.out.println(massage);
                   // System.out.println("----------------------------------------------");
                	String version=revCommit.getName();//版本号  
                    String aname = revCommit.getAuthorIdent().getName();  
                    String aemail = revCommit.getAuthorIdent().getEmailAddress();  
                    Date awhen = revCommit.getAuthorIdent().getWhen();
                    Date cwhen = revCommit.getCommitterIdent().getWhen();
                    String cname = revCommit.getCommitterIdent().getName();//committer
                    String cemail= revCommit.getCommitterIdent().getEmailAddress();
                    String massage = revCommit.getFullMessage();
                    List<String> signoff = signoff=revCommit.getFooterLines("Tested-by");
                    int year=cwhen.getYear();
                    int month=cwhen.getMonth();
                    //处理某年某月之后的commit
                    if(year>114 && month>=6){
                    	s++;
                    System.out.println("Author: "+aname+"<"+aemail+">"); 
                    System.out.println(awhen.toString()); 
                    System.out.println("Commiter: "+cname+"<"+cemail+">"); 
                    System.out.println(cwhen.toString()); 
                    System.out.println("JiraID: "+massage.substring(0, 7));
                    System.out.println("CommitInfo: "+ massage);
                    System.out.println("Tested-by: "+ signoff);
                    //System.out.println("the monthe is"+ month);
                    System.out.println("----------------------------------------------"); }
                	i++;
                }  
                
            }catch (NoHeadException e) {  
                e.printStackTrace();  
            } catch (GitAPIException e) {  
                e.printStackTrace();  
            } catch (IOException e) {  
                e.printStackTrace();  
            }  
            System.out.println(i);
            System.out.println(s);
            
    }  
	public static void main(String[] args) {
		// TODO Auto-generated method stub

		AccessGit.getHistoryInfo();
	}

}
